using CleanUps.BusinessLogic.Interfaces.PrivateAccess;
using CleanUps.Shared.DTOs;
using CleanUps.Shared.ErrorHandling;

namespace CleanUps.BusinessLogic.Validators
{
    internal class EventValidator : IValidator<EventDTO>
    {
        public OperationResult<EventDTO> ValidateForCreate(EventDTO eventDto)
        {
            if (eventDto == null)
            {
                return OperationResult<EventDTO>.BadRequest("Event DTO cannot be null.");
            }

            ValidateCommonFields(eventDto);

            // For create, EventId should not be set (it will be generated by the database)
            if (eventDto.EventId != 0)
            {
                return OperationResult<EventDTO>.BadRequest("EventId should not be set when creating a new event.");
            }
            return OperationResult<EventDTO>.Ok(eventDto);
        }

        public OperationResult<EventDTO> ValidateForUpdate(int id, EventDTO eventDto)
        {
            if (eventDto == null)
            {
                return OperationResult<EventDTO>.BadRequest("Event DTO cannot be null.");
            }
            if (id != eventDto.EventId)
            {
                return OperationResult<EventDTO>.BadRequest("Event-ID and the Id from URL does not match");
            }
            if (id <= 0)
            {
                return OperationResult<EventDTO>.BadRequest("Event ID must be greater than zero.");
            }

            if (eventDto.EventId <= 0)
            {
                return OperationResult<EventDTO>.BadRequest("Event ID must be greater than zero.");
            }

            ValidateCommonFields(eventDto);
            return OperationResult<EventDTO>.Ok(eventDto);
        }

        public OperationResult<string> ValidateId(int id)
        {
            if (id <= 0)
            {
                return OperationResult<string>.BadRequest("Event ID must be greater than zero.");
            }
            return OperationResult<string>.Ok("Id is valid");
        }

        private OperationResult<EventDTO> ValidateCommonFields(EventDTO eventDto)
        {
            if (string.IsNullOrWhiteSpace(eventDto.StreetName))
            {
                return OperationResult<EventDTO>.BadRequest("StreetName is required.");
            }

            if (string.IsNullOrWhiteSpace(eventDto.City))
            {
                return OperationResult<EventDTO>.BadRequest("City is required.");
            }

            if (string.IsNullOrWhiteSpace(eventDto.ZipCode))
            {
                return OperationResult<EventDTO>.BadRequest("ZipCode is required.");
            }

            if (string.IsNullOrWhiteSpace(eventDto.Country))
            {
                return OperationResult<EventDTO>.BadRequest("Country is required.");
            }

            if (string.IsNullOrWhiteSpace(eventDto.Description))
            {
                return OperationResult<EventDTO>.BadRequest("Description is required.");
            }

            if (string.IsNullOrWhiteSpace(eventDto.Status))
            {
                return OperationResult<EventDTO>.BadRequest("Status is required.");
            }

            if (eventDto.DateOfEvent < DateOnly.FromDateTime(DateTime.Today))
            {
                return OperationResult<EventDTO>.BadRequest("Event date cannot be in the past.");
            }

            if (eventDto.StartTime >= eventDto.EndTime)
            {
                return OperationResult<EventDTO>.BadRequest("StartTime must be before EndTime.");
            }

            if (eventDto.TrashCollected.HasValue && eventDto.TrashCollected < 0)
            {
                return OperationResult<EventDTO>.BadRequest("TrashCollected cannot be negative.");
            }

            if (eventDto.NumberOfAttendees < 0)
            {
                return OperationResult<EventDTO>.BadRequest("NumberOfAttendees cannot be negative.");
            }
            return OperationResult<EventDTO>.Ok(eventDto);
        }
    }
}
